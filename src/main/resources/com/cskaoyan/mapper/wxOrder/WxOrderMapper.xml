<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cskaoyan.mapper.wxOrder.WxOrderMapper">
    <resultMap id="myOrderMap" type="com.cskaoyan.bean.wxBean.WxOrder">
        <result column="id" property="id"/>
        <result column="order_sn" property="orderSn"/>
        <result column="actual_price" property="actualPrice"/>
        <result column="order_status" property="orderStatus"/>
        <result column="comments" property="comments"/>
        <association property="handleOption" javaType="com.cskaoyan.bean.wxgrouponrela.HandleOption">
            <result column="cancel" property="cancel"/>
            <result column="comment" property="comment"/>
            <result column="confirm" property="confirm"/>
            <result column="delete" property="delete"/>
            <result column="pay" property="pay"/>
            <result column="rebuy" property="rebuy"/>
            <result column="refund" property="refund"/>
        </association>
        <collection property="goodsList" ofType="com.cskaoyan.bean.wxBean.WxOrderGoods">
            <result column="gid" property="id"/>
            <result column="goods_name" property="goodsName"/>
            <result column="number" property="number"/>
            <result column="pic_url" property="picUrl"/>
        </collection>
    </resultMap>

    <resultMap id="detailMap" type="com.cskaoyan.bean.wxBean.WxOrderDetail">
        <association property="orderInfo" javaType="com.cskaoyan.bean.wxBean.WxOrderInfo">
            <result  column="id" property="id"/>
            <result  column="user_id" property="userId"/>
            <result  column="order_sn" property="orderSn"/>
            <result  column="order_status" property="orderStatus"/>
            <result  column="consignee" property="consignee"/>
            <result  column="mobile" property="mobile"/>
            <result  column="address" property="address"/>
            <result  column="message" property="message"/>
            <result  column="goods_price" property="goodsPrice"/>
            <result  column="freight_price" property="freightPrice"/>
            <result  column="coupon_price" property="couponPrice"/>
            <result  column="integral_price" property="integralPrice"/>
            <result  column="groupon_price" property="grouponPrice"/>
            <result  column="order_price" property="orderPrice"/>
            <result  column="actual_price" property="actualPrice"/>
            <result  column="pay_id" property="payId"/>
            <result  column="pay_time" property="payTime"/>
            <result  column="ship_sn" property="shipSn"/>
            <result  column="ship_channel" property="shipChannel"/>
            <result  column="ship_time" property="shipTime"/>
            <result  column="confirm_time" property="confirmTime"/>
            <result  column="comments" property="comments"/>
            <result  column="end_time" property="endTime"/>
            <result  column="oadd_time" property="addTime"/>
            <result  column="oupdate_time" property="updateTime"/>
            <result  column="odeleted" property="deleted"/>
            <association property="handleOption" javaType="com.cskaoyan.bean.wxgrouponrela.HandleOption">
                <result column="cancel" property="cancel"/>
                <result column="com" property="comment"/>
                <result column="confirm" property="confirm"/>
                <result column="delete" property="delete"/>
                <result column="pay" property="pay"/>
                <result column="rebuy" property="rebuy"/>
                <result column="refund" property="refund"/>
            </association>
        </association>
        <collection property="orderGoods" ofType="com.cskaoyan.bean.OrderGoods">
            <result column="gid" property="id"/>
            <result column="order_id" property="orderId"/>
            <result column="goods_id" property="goodsId"/>
            <result column="goods_name" property="goodsName"/>
            <result column="goods_sn" property="goodsSn"/>
            <result column="product_id" property="productId"/>
            <result column="number" property="number"/>
            <result column="price" property="price"/>
            <result column="specifications" property="specifications"/>
            <result column="pic_url" property="picUrl"/>
            <result column="comment" property="comment"/>
            <result column="gadd_time" property="addTime"/>
            <result column="gupdate_time" property="updateTime"/>
            <result column="gdelete" property="deleted"/>
        </collection>

    </resultMap>
    <select id="showOrders" resultMap="myOrderMap">
        select
        cskaoyan_mall_order.id,
        cskaoyan_mall_order.order_sn,
        cskaoyan_mall_order.order_status,
        cskaoyan_mall_order.actual_price,
        cskaoyan_mall_order.comments,

        cskaoyan_mall_handleoption.cancel,
        cskaoyan_mall_handleoption.comment,
        cskaoyan_mall_handleoption.confirm,
        cskaoyan_mall_handleoption.delete,
        cskaoyan_mall_handleoption.pay,
        cskaoyan_mall_handleoption.rebuy,
        cskaoyan_mall_handleoption.refund,

        cskaoyan_mall_order_goods.id as gid,
        cskaoyan_mall_order_goods.goods_name,
        cskaoyan_mall_order_goods.number,
        cskaoyan_mall_order_goods.pic_url

        from cskaoyan_mall_order
        LEFT JOIN cskaoyan_mall_order_goods
        ON cskaoyan_mall_order.id=cskaoyan_mall_order_goods.order_id
        LEFT JOIN cskaoyan_mall_handleoption
        ON	cskaoyan_mall_order.order_status=cskaoyan_mall_handleoption.order_status
        where cskaoyan_mall_order.user_id=#{uid}
    </select>



    <select id="queryDetailByOid" resultMap="detailMap">
        select
        cskaoyan_mall_order.id,
        cskaoyan_mall_order.user_id,
        cskaoyan_mall_order.order_sn,
        cskaoyan_mall_order.order_status,
        cskaoyan_mall_order.consignee,
        cskaoyan_mall_order.mobile as omible,
        cskaoyan_mall_order.address,
        cskaoyan_mall_order.message,
        cskaoyan_mall_order.goods_price,
        cskaoyan_mall_order.freight_price,
        cskaoyan_mall_order.coupon_price,
        cskaoyan_mall_order.integral_price,
        cskaoyan_mall_order.groupon_price,
        cskaoyan_mall_order.order_price,
        cskaoyan_mall_order.actual_price,
        cskaoyan_mall_order.pay_id,
        cskaoyan_mall_order.pay_time,
        cskaoyan_mall_order.ship_sn,
        cskaoyan_mall_order.ship_channel,
        cskaoyan_mall_order.ship_time,
        cskaoyan_mall_order.confirm_time,
        cskaoyan_mall_order.comments,
        cskaoyan_mall_order.end_time ,
        cskaoyan_mall_order.add_time AS oadd_time,
        cskaoyan_mall_order.update_time AS oupdate_time,
        cskaoyan_mall_order.deleted AS odeleted,

        cskaoyan_mall_order_goods.id as gid,
        cskaoyan_mall_order_goods.order_id,
        cskaoyan_mall_order_goods.goods_id,
        cskaoyan_mall_order_goods.goods_name,
        cskaoyan_mall_order_goods.goods_sn,
        cskaoyan_mall_order_goods.product_id,
        cskaoyan_mall_order_goods.number,
        cskaoyan_mall_order_goods.price,
        cskaoyan_mall_order_goods.specifications,
        cskaoyan_mall_order_goods.pic_url,
        cskaoyan_mall_order_goods.comment,
        cskaoyan_mall_order_goods.add_time as gadd_time,
        cskaoyan_mall_order_goods.update_time as gupdate_time,
        cskaoyan_mall_order_goods.deleted as gdelete,

        cskaoyan_mall_handleoption.cancel,
        cskaoyan_mall_handleoption.comment as com,
        cskaoyan_mall_handleoption.confirm,
        cskaoyan_mall_handleoption.delete,
        cskaoyan_mall_handleoption.pay,
        cskaoyan_mall_handleoption.rebuy,
        cskaoyan_mall_handleoption.refund
        from cskaoyan_mall_order
        LEFT JOIN cskaoyan_mall_order_goods
        ON cskaoyan_mall_order.id=cskaoyan_mall_order_goods.order_id
        LEFT JOIN cskaoyan_mall_handleoption
        ON	cskaoyan_mall_order.order_status=cskaoyan_mall_handleoption.order_status
        where cskaoyan_mall_order.id=#{oid}
    </select>

    <delete id="deleteOrder">
        delete from cskaoyan_mall_order where id=#{oid}
    </delete>

    <update id="changeOrderStatus">
        update cskaoyan_mall_order set order_status=#{status},update_time=now()
        where id=#{oid}
    </update>
    <resultMap id="orderGoodsMap" type="com.cskaoyan.bean.OrderGoods">
        <result column="gid" property="id"/>
        <result column="order_id" property="orderId"/>
        <result column="goods_id" property="goodsId"/>
        <result column="goods_name" property="goodsName"/>
        <result column="goods_sn" property="goodsSn"/>
        <result column="product_id" property="productId"/>
        <result column="number" property="number"/>
        <result column="price" property="price"/>
        <result column="specifications" property="specifications"/>
        <result column="pic_url" property="picUrl"/>
        <result column="comment" property="comment"/>
        <result column="gadd_time" property="addTime"/>
        <result column="gupdate_time" property="updateTime"/>
        <result column="gdelete" property="deleted"/>
    </resultMap>
    <select id="queryOGByOidAndGid" resultMap="orderGoodsMap">
        select
        id ,
        order_id,
        goods_id,
        goods_name,
        goods_sn,
        product_id,
        number,
        price,
        specifications,
        pic_url,
        comment,
        add_time,
        update_time,
        deleted
        from cskaoyan_mall_order_goods
        where order_id=#{oid} and goods_id=#{gid}
    </select>
</mapper>